{"version":3,"sources":["../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/app.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/app.css","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/app.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/containers/labeled-control.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/containers/labeled-control.css","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/containers/labeled-control.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/containers/qp-fieldset.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/containers/qp-fieldset.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/containers/screen-container.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/containers/screen-container.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/containers/vertical-stack.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/containers/vertical-stack.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/outlook-data/outlook-data.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/outlook-data/outlook-data.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/qp-command-button.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/qp-command-button.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/qp-container.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/qp-container.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/qp-label-fake.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/qp-label-fake.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/qp-longrun-indicator.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/controls/qp-longrun-indicator.html","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/enhanced-compose.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/main.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/services/authentication-service.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/services/screen-api-client.ts","../../../../../..C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/C:\\Bld2\\AC-FULLCOMMON27-JOB1\\code_repo\\ClientSideApps\\qp-packages\\outlook-plugin-app/src/apps/outlook-plugin/services/screen-data.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAWA;QAmBE,aAAoB,MAAkB,EAAU,SAAoB,EAAU,UAAsB,EAAU,cAA8B,EAAU,qBAA4C;YAA9K,WAAM,GAAN,MAAM,CAAY;YAAU,cAAS,GAAT,SAAS,CAAW;YAAU,eAAU,GAAV,UAAU,CAAY;YAAU,mBAAc,GAAd,cAAc,CAAgB;YAAU,0BAAqB,GAArB,qBAAqB,CAAuB;YAblM,gBAAW,GAAG,KAAK,CAAC;YAclB,IAAM,KAAK,GAAG,IAAI,CAAA;YAClB,IAAM,IAAI,GAAG,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,cAAc,EAAE,GAAG,CAAC,CAAA;YAC/E,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAA;YACvB,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,YAAY,CAAC,CAAA;YACxC,IAAI,CAAC,eAAe,GAAG,UAAU,CAAA;YAEjC,IAAI,CAAC,iBAAiB,GAAG,4BAAQ,CAAC,MAAM,CAAC,iBAAiB,CAAA;YAE1D,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,UAAC,MAAM;gBAE3B,MAAM;qBACH,WAAW,CAAC,IAAI,CAAC;qBACjB,YAAY,CAAC;oBACZ,OAAO,EAAE;wBACP,QAAQ,EAAE,kBAAkB;wBAC5B,kBAAkB,EAAE,OAAO;qBAC5B;oBACD,WAAW,EAAE,aAAa;iBAE3B,CAAC;qBAED,eAAe,CAAC;oBAET,QAAQ,YAAC,CAAC;;;;;4CACG,WAAM,CAAC,CAAC,KAAK,EAAE,EAAA;;wCAA1B,QAAQ,GAAG,SAAe;wCAC1B,WAAW,GAAG,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;6CACrD,CAAA,WAAW,IAAI,WAAW,CAAC,OAAO,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAA,EAA7D,cAA6D;wCACrD,WAAM,QAAQ,CAAC,IAAI,EAAE,EAAA;;wCAAzB,CAAC,GAAG,SAAqB;wCAC/B,IAAI,CAAC,CAAC,QAAQ,KAAK,UAAU,EAAE;4CAC7B,IAAI,CAAC,CAAC,IAAI,KAAK,CAAC,EAAE;gDAChB,IAAI,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,8BAA8B,CAAC,GAAG,CAAC,CAAC,EAAE;oDACtD,KAAK,CAAC,qBAAqB,CAAC,QAAQ,EAAE,CAAA;oDACtC,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAA;iDACrC;6CACF;iDAAM,IAAI,CAAC,CAAC,IAAI,KAAK,CAAC,EAAE;gDACvB,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC,kBAAkB,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;6CAC5C;yCACF;;4CAEH,WAAO,CAAC,EAAA;;;;qBACT;iBACF,CAAC,CAAA;YACN,CAAC,CAAC,CAAA;QAEJ,CAAC;QAED,oCAAsB,GAAtB,UAAuB,QAAQ,EAAE,QAAQ;YAAzC,mBAKC;YAJC,IAAI,QAAQ,EAAE;gBACZ,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,QAAQ,CAAC;qBACxC,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,OAAI,CAAC,iBAAiB,CAAC,OAAO,GAAG,CAAC,EAAlC,CAAkC,CAAC,CAAA;aACjD;QACH,CAAC;QACD,mCAAqB,GAArB,UAAsB,QAAQ,EAAE,QAAQ;YACtC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;QACvB,CAAC;QAGK,sBAAQ,GAAd;;;;;oBAGQ,MAAM,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,IAAO,QAAQ,GAAG,OAAO,CAAC,CAAC,cAAc,GAAG,MAAM,CAAA,CAAC,CAAC,CAAC,CAAA;oBAChG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,yBAAyB,CAAC,UAAC,WAAW;wBAC3D,OAAI,CAAC,qBAAqB,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,CAAC,CAAA;wBAC1D,OAAI,CAAC,qBAAqB,CAAC,gBAAgB,EAAE;6BAC1C,IAAI,CAAC,UAAA,CAAC;4BACL,QAAQ,EAAE,CAAA;wBACZ,CAAC,CAAC;6BACD,KAAK,CAAC,UAAA,CAAC;4BACN,cAAc,EAAE,CAAA;wBAClB,CAAC,CAAC,CAAA;oBACN,CAAC,CAAC,CAAA;oBACF,WAAO,MAAM,EAAA;;;SAEd;QAEK,6BAAe,GAArB;;;;;oBAIQ,MAAM,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,IAAO,QAAQ,GAAG,OAAO,CAAC,CAAC,cAAc,GAAG,MAAM,CAAA,CAAC,CAAC,CAAC,CAAA;oBAEhG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,yBAAyB,CAAC,UAAC,WAAW;wBAC3D,OAAI,CAAC,qBAAqB,CAAC,eAAe,CAAC,WAAW,CAAC,KAAK,CAAC;6BAC1D,IAAI,CAAC,UAAA,CAAC;4BACL,QAAQ,EAAE,CAAA;wBACZ,CAAC,CAAC;6BACD,KAAK,CAAC,UAAA,CAAC;4BACN,cAAc,EAAE,CAAA;wBAClB,CAAC,CAAC,CAAA;oBACN,CAAC,CAAC,CAAA;oBACF,WAAO,MAAM,EAAA;;;SACd;QAEK,sBAAQ,GAAd;;;;;oBAEQ,QAAQ,GAAG,IAAI,OAAO,CAAC,UAAC,CAAC,IAAO,WAAW,GAAG,CAAC,CAAA,CAAC,CAAC,CAAC,CAAA;oBAExD,MAAM,CAAC,UAAU,GAAG;wBAClB,WAAW,EAAE,CAAA;wBAIb,OAAI,CAAC,eAAe,EAAE;6BACnB,IAAI,CAAC,cAAQ,OAAI,CAAC,WAAW,GAAG,IAAI,CAAA,CAAC,CAAC,CAAC;6BACvC,KAAK,CAAC,UAAA,CAAC,IAAM,OAAI,CAAC,WAAW,GAAG,IAAI,CAAA,CAAC,CAAC,CAAC,CAAA;oBAC5C,CAAC,CAAA;oBAID,WAAO,QAAQ,EAAA;;;SAChB;QAEK,mBAAK,GAAX;;;;gCAEE,WAAM,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,cAAc,CAAC,EAAA;;4BAA/G,SAA+G,CAAA;4BAE/G,IAAI,IAAI,CAAC,qBAAqB,CAAC,aAAa,EAAE;gCAC5C,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAA;gCAClB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAA;6BACnB;;;;;SACF;QAtID;YAFC,8BAAU;;gDAES;QAIpB;YADC,8BAAU;;4CACI;QAOf;YADC,8BAAU;;oDACa;QAjBb,GAAG;YADf,8BAAU;6CAoBmB,iCAAU,EAAqB,6BAAS,EAAsB,8BAAU,EAA0B,kCAAc,EAAiC,8CAAqB;WAnBvL,GAAG,CA+If;QAAD,UAAC;KA/ID,AA+IC,IAAA;IA/IY,kBAAG;;;ACXhB;ACAA;;;;;;;;;;;;;;ICGA;QAAA;YAGY,gBAAW,GAAG,SAAS,CAAA;QAanC,CAAC;QATC,sBAAI,gDAAK;iBAAT;;gBACE,UAAG,IAAI,CAAC,aAAa,0CAAE,aAAa,EAAC;oBACnC,OAAO,SAAS,CAAA;iBACjB;gBACD,UAAI,IAAI,CAAC,aAAa,0CAAE,MAAM,EAAE;oBAC9B,OAAO,SAAS,CAAA;iBACjB;gBACD,aAAO,IAAI,CAAC,aAAa,0CAAE,WAAW,CAAA;YACxC,CAAC;;;WAAA;QAdS;YAAT,4BAAQ;;4EAAc;QAC+B;YAArD,4BAAQ,CAAC,EAAE,kBAAkB,EAAE,+BAAW,CAAC,MAAM,EAAE,CAAC;;2EAAa;QACxD;YAAT,4BAAQ;;0EAAwB;QAIjC;YADC,gCAAY,CAAC,2BAA2B,EAAE,sBAAsB,EAAC,6BAA6B,CAAC;;;kEAS/F;QAfU,6BAA6B;YADzC,iCAAa,CAAC,oBAAoB,CAAC;WACvB,6BAA6B,CAgBzC;QAAD,oCAAC;KAhBD,AAgBC,IAAA;IAhBY,sEAA6B;;;ACH1C;ACAA;;;;;;;;;;;;;;ICOA;QAQE,iCAAoB,UAAsB,EAAU,eAAgC;YAAhE,eAAU,GAAV,UAAU,CAAY;YAAU,oBAAe,GAAf,eAAe,CAAiB;YADpF,uBAAkB,GAAY,KAAK,CAAA;QAInC,CAAC;QACD,0CAAQ,GAAR;YAAA,iBAMC;YAJC,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,gBAAgB,EAAE;gBAEzE,KAAI,CAAC,kBAAkB,GAAG,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,KAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,OAAO,EAArC,CAAqC,CAAC,CAAA;YAC1F,CAAC,CAAC,CAAA;QACJ,CAAC;QACD,0CAAQ,GAAR;;YACE,MAAA,IAAI,CAAC,kBAAkB,0CAAE,OAAO,GAAE;QACpC,CAAC;QAnBS;YAAT,4BAAQ;;iEAAqB;QACpB;YAAT,4BAAQ;;+DAA+B;QAH7B,uBAAuB;YAFnC,8BAAU;YACV,iCAAa,CAAC,aAAa,CAAC;6CASK,wBAAU,EAA2B,0CAAe;WARzE,uBAAuB,CAsBnC;QAAD,8BAAC;KAtBD,AAsBC,IAAA;IAtBY,0DAAuB;;;ACPpC;;;;;;;;;;;;;;ICMA;QAKE,wCAAoB,UAAsB,EAAU,UAAsB;YAAtD,eAAU,GAAV,UAAU,CAAY;YAAU,eAAU,GAAV,UAAU,CAAY;QAE1E,CAAC;QAED,sDAAa,GAAb,UAAc,QAAQ;QAEtB,CAAC;QACD,iDAAQ,GAAR;YACE,OAAO,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAA;QAEzD,CAAC;QACD,iDAAQ,GAAR;YACE,OAAO,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,CAAA;QACxC,CAAC;QAdS;YAAT,4BAAQ;;sEAAO;QAJL,8BAA8B;YAF1C,iCAAa,CAAC,qBAAqB,CAAC;YACpC,8BAAU;6CAMuB,wBAAU,EAAsB,wBAAU;WAL/D,8BAA8B,CAmB1C;QAAD,qCAAC;KAnBD,AAmBC,IAAA;IAnBY,wEAA8B;;;ACN3C;;;;;ICAA;QAAA;QAEA,CAAC;QAAD,4CAAC;IAAD,CAFA,AAEC,IAAA;IAFY,sFAAqC;;;ACAlD;;;;;;;;;;;;;;ICQA;QAOE,oCAAoB,SAAoB,EAAU,UAAsB,EAAU,SAAoB,EAAU,eAAgC;YAA5H,cAAS,GAAT,SAAS,CAAW;YAAU,eAAU,GAAV,UAAU,CAAY;YAAU,cAAS,GAAT,SAAS,CAAW;YAAU,oBAAe,GAAf,eAAe,CAAiB;YAFhJ,QAAG,GAAG,KAAK,CAAA;QAKX,CAAC;QAED,kDAAa,GAAb,UAAc,CAAC,EAAE,CAAC;QAElB,CAAC;QAGD,6CAAQ,GAAR;YAAA,iBAcC;YAVC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,cAAQ,KAAI,CAAC,WAAW,EAAE,CAAA,CAAC,CAAC,CAAC,CAAA;QAUxD,CAAC;QACD,gDAAW,GAAX;YAAA,iBA0GC;YAzGC,IAAM,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAA;YAC3C,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,CAAA;YAClD,IAAI,CAAC,OAAO,EAAE;gBACZ,OAAM;aACP;YAED,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE;gBACzB,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE;oBAClC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAA;iBAC/D;gBACD,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,YAAY,EAAE;oBACtC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,YAAY,EAAE,OAAO,CAAC,MAAM,CAAC,YAAY,CAAC,CAAA;iBAC1F;gBAED,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE;oBACrC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE,OAAO,CAAC,MAAM,CAAC,WAAW,CAAC,CAAA;iBACxF;gBAED,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,YAAY,EAAE;oBACtC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,YAAY,EAAE,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAA;iBACvG;gBAED,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE;oBACrC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE,WAAW,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAA;iBACrG;gBAED,IAAI,OAAO,CAAC,MAAM,CAAC,YAAY,IAAI,EAAE,IAAI,OAAO,CAAC,MAAM,CAAC,YAAY,IAAI,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,YAAY,EAAE;oBACvH,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE;wBAClC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAA;qBAChE;oBAED,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE;wBACrC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE,EAAE,CAAC,CAAA;qBAChE;oBAED,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,YAAY,EAAE;wBACtC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,YAAY,EAAE,EAAE,CAAC,CAAA;qBACjE;oBAED,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE;wBACrC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE,EAAE,CAAC,CAAA;qBAChE;iBACF;gBAGD,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,SAAS,EAAE;oBACnC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,SAAS,EAAE,OAAO,CAAC,iBAAiB,CAAC,CAAA;iBACrF;gBACD,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,EAAE;oBACjC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,CAAA;iBACzE;gBACD,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE;oBAChC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE,OAAO,CAAC,MAAM,CAAC,CAAA;iBACvE;gBACD,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE;oBAC5B,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,oBAAoB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAA;iBACrF;gBACD,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE;oBAC5B,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,oBAAoB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAA;iBACrF;gBACD,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE;oBAChC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;iBACtF;gBACD,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,eAAe,EAAE;oBAEzC,IAAM,KAAK,GAAI,OAAO,CAAC,WAAqB,CAAC,MAAM,CAAC,UAAU,CAAC;wBAC7D,OAAO,CAAC,CAAC,WAAW,KAAK,iBAAiB;4BACxC,CAAC,CAAC,WAAW,KAAK,mBAAmB;4BACrC,CAAC,CAAC,WAAW,KAAK,0BAA0B;gCAC5C,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;oBACnE,CAAC,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,OAAO,CAAC,CAAC,IAAI,CAAA,CAAC,CAAC,CAAC,CAAA;oBAGtC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,gBAAgB,EAAE,KAAK,CAAC,MAAM,CAAC,CAAA;oBAC9E,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,eAAe,EAAE,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,CAAA;iBACvF;gBAGD,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,qBAAqB,CAC1C,UAAC,WAAW;oBAEV,IAAI,WAAW,CAAC,MAAM,KAAK,WAAW,EAAE;wBAEtC,IAAI,KAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE;4BAClC,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,KAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,WAAW,CAAC,KAAK,CAAC,CAAA;yBAC5E;qBACF;oBACD,KAAI,CAAC,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAA;gBACjD,CAAC,CAAC,CAAC;gBAEH,aAAa,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAA;gBACvC,IAAI,CAAC,mBAAmB,GAAG,WAAW,CAAC;oBAErC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,qBAAqB,CAC1C,UAAC,WAAW;wBACV,IAAI,WAAW,CAAC,MAAM,KAAK,WAAW,EAAE;4BACtC,IAAI,KAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE;gCAClC,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,KAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,WAAW,CAAC,KAAK,CAAC,CAAA;6BAC5E;yBACF;oBAEH,CAAC,CAAC,CAAC;gBACP,CAAC,EAAC,KAAK,CAAC,CAAA;aAEX;QACH,CAAC;QAzIS;YAAT,4BAAQ;;kEAA2B;QAC1B;YAAT,4BAAQ;;iEAAM;QAFJ,0BAA0B;YAFtC,8BAAU;YACV,iCAAa,CAAC,iBAAiB,CAAC;6CAQA,6BAAS,EAAsB,wBAAU,EAAqB,6BAAS,EAA2B,0CAAe;WAPrI,0BAA0B,CA2ItC;QAAD,iCAAC;KA3ID,AA2IC,IAAA;IA3IY,gEAA0B;IAkJvC,SAAS,oBAAoB,CAAC,IAAI;QAChC,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,IAAI,IAAI,IAAI,IAAI;YACd,IAAI,CAAC,OAAO,CAAC,UAAU,KAAK,EAAE,KAAK;gBACjC,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,KAAK,CAAC,WAAW,GAAG,IAAI,GAAG,IAAI,GAAG,KAAK,CAAC,YAAY,GAAG,IAAI,CAAC;YACjF,CAAC,CAAC,CAAC;QACL,OAAO,GAAG,CAAC;IACb,CAAC;IAED,SAAS,YAAY,CAAC,WAAW;QAC/B,WAAW,GAAG,WAAW,CAAC,IAAI,EAAE,CAAC;QACjC,OAAO,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACnC,WAAW,GAAG,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAC/C,IAAI,KAAK,GAAG,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACnC,IAAI,SAAS,GAAG,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QACnD,OAAO,SAAS,CAAC;IACnB,CAAC;IAED,SAAS,WAAW,CAAC,WAAW;QAC9B,WAAW,GAAG,WAAW,CAAC,IAAI,EAAE,CAAC;QACjC,OAAO,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACnC,WAAW,GAAG,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAC/C,IAAI,KAAK,GAAG,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACnC,IAAI,QAAQ,GAAG,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QACrE,OAAO,QAAQ,CAAC;IAClB,CAAC;;;ACnLD;;;;;;;;;;;;;;ICOA;QAEE,sCAAoB,UAAsB;YAAtB,eAAU,GAAV,UAAU,CAAY;QAE1C,CAAC;QAED,4CAAK,GAAL;YACE,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;QAC3E,CAAC;QAPS;YAAT,4BAAQ;;oEAAO;QADL,4BAA4B;YAHxC,iCAAa,CAAC,mBAAmB,CAAC;YAElC,8BAAU;6CAGuB,wBAAU;WAF/B,4BAA4B,CASxC;QAAD,mCAAC;KATD,AASC,IAAA;IATY,oEAA4B;;;ACPzC;;;;;;;;;;;;;;ICKA;QAGE,kCAAoB,UAAsB;YAAtB,eAAU,GAAV,UAAU,CAAY;QAG1C,CAAC;QAJS;YAAT,4BAAQ;;kEAAS;QAFP,wBAAwB;YAFpC,8BAAU;YACV,iCAAa,CAAC,cAAc,CAAC;6CAII,wBAAU;WAH/B,wBAAwB,CAOpC;QAAD,+BAAC;KAPD,AAOC,IAAA;IAPY,4DAAwB;;;ACLrC;;;;;;;;;;;ICIA;QAAA;QAEA,CAAC;QAFY,wBAAwB;YAFpC,0BAAM;YACN,iCAAa,CAAC,eAAe,CAAC;WAClB,wBAAwB,CAEpC;QAAD,+BAAC;KAFD,AAEC,IAAA;IAFY,4DAAwB;;;ACJrC;;;;;;;;;;;;;;ICMA;QAKE,yCAAoB,eAAgC;YAApD,iBAGC;YAHmB,oBAAe,GAAf,eAAe,CAAiB;YAJpD,SAAI,GAAY,KAAK,CAAA;YAKnB,eAAe,CAAC,SAAS,CAAC,iBAAiB,EAAE,cAAQ,KAAI,CAAC,IAAI,GAAG,IAAI,CAAA,CAAC,CAAC,CAAC,CAAA;YACxE,eAAe,CAAC,SAAS,CAAC,iBAAiB,EAAE,cAAQ,KAAI,CAAC,IAAI,GAAG,KAAK,CAAA,CAAC,CAAC,CAAC,CAAA;QAC3E,CAAC;QALS;YAAT,4BAAQ;;uEAAO;QAHL,+BAA+B;YAF3C,iCAAa,CAAC,sBAAsB,CAAC;YACrC,8BAAU;6CAM4B,0CAAe;WALzC,+BAA+B,CAS3C;QAAD,sCAAC;KATD,AASC,IAAA;IATY,0EAA+B;;;ACN5C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICGA,IAAM,MAAM,GAAG,2BAAS,CAAC,kBAAkB,CAAC,CAAA;IAK5C;QAUE,sCAAoB,SAAoB,EAAU,aAA4B,EAAU,OAAgB,EAAU,iBAAoC,EAAU,iBAAoC;YAAhL,cAAS,GAAT,SAAS,CAAW;YAAU,kBAAa,GAAb,aAAa,CAAe;YAAU,YAAO,GAAP,OAAO,CAAS;YAAU,sBAAiB,GAAjB,iBAAiB,CAAmB;YAAU,sBAAiB,GAAjB,iBAAiB,CAAmB;YAElM,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,iBAAiB,CAAC,WAAW,CAAC;QAExD,CAAC;QAED,2CAAI,GAAJ,UAAK,cAAc,EAAE,eAAe;YAClC,IAAI,CAAC,cAAc,GAAG,cAAc,CAAC;YACrC,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;YACvC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACxC,CAAC;QAGD,mEAA4B,GAA5B,UAA6B,oBAA4B;YACvD,IAAM,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC;YAC9D,IAAI,CAAC,EAAE;gBACL,OAAO,CAAC,CAAC,MAAM,CAAA;aAChB;iBACI;gBACH,IAAM,GAAC,GAAG,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAA;aAC1D;QACH,CAAC;QAMK,uDAAgB,GAAtB,UAAuB,SAAS;;;;;oBAI9B,IAAI,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,oBAAoB,EAAE;wBACnD,WAAO;qBACR;oBACD,IAAI,SAAS,EAAE;wBAEP,OAAO,GAAG,IAAI,CAAC,4BAA4B,CAAC,SAAS,CAAC,CAAA;wBAC5D,IAAI,CAAC,OAAO,EAAE;4BACZ,MAAM,CAAC,KAAK,CAAC,kCAAkC,EAAE,SAAS,CAAC,CAAA;yBAC5D;wBACK,UAAQ;4BACZ,cAAc,EAAE,IAAI,CAAC,cAAc;4BACnC,eAAe,EAAE,IAAI,CAAC,eAAe;4BACrC,SAAS,EAAE,OAAO;4BAClB,SAAS,EAAE,IAAI,CAAC,SAAS;4BACzB,IAAI,EAAE,IAAI,CAAC,OAAO;4BAClB,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,iCAAa,CAAC;4BAChD,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,4BAAQ,CAAC;yBACvC,CAAC;wBACF,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC,iBAAiB;6BAClD,OAAO,CAAC,OAAK,CAAC;6BACd,IAAI,CACH,UAAC,UAAsB;4BAErB,KAAI,CAAC,gBAAgB,GAAG,UAAU,CAAC,SAAS,CAAC;4BAC7C,IAAM,gBAAgB,GAAG,4BAAQ,CAAC,GAAG,CACnC,4BAAQ,CAAC,QAAQ,EACjB,UAAU,CAAC,SAAS,CAAC,WAAW,CAC1B,CAAC;4BACT,IAAI,gBAAgB,EAAE;gCACpB,IAAM,SAAS,GAAG,gBAAgB,CAAC,UAAU,CAAC;wDACnC,QAAQ;oCACjB,IAAM,UAAU,GAAG,KAAI,CAAC,WAAW,CAAC,IAAI,CACtC,UAAA,GAAG,IAAI,OAAA,GAAG,CAAC,cAAc,KAAK,QAAQ,CAAC,IAAI,EAApC,CAAoC,CAC5C,CAAC;oCACF,IAAI,UAAU,EAAE;wCACd,IAAM,CAAC,GAAG,UAAU,CAAC,aAAa,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;wCACzD,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;qCAC/B;;gCAPH,KAAuB,UAAS,EAAT,uBAAS,EAAT,uBAAS,EAAT,IAAS;oCAA3B,IAAM,QAAQ,kBAAA;4CAAR,QAAQ;iCAQlB;6BACF;4BAED,UAAU,CAAC,IAAI,CAAC,OAAK,CAAC,CAAC;wBACzB,CAAC,EACD,UAAA,EAAE;4BACA,MAAM,CAAC,KAAK,CAAC,iBAAiB,EAAC,EAAE,CAAC,CAAA;wBACpC,CAAC,CACF;6BACA,IAAI,CAAC;4BACJ,KAAI,CAAC,uBAAuB,GAAG,SAAS,CAAC;wBAC3C,CAAC,CAAC,CAAC;qBACN;;;;SACF;QA3FS;YAAT,4BAAQ;;uEAAU;QADR,4BAA4B;YAHxC,0BAAM;YACN,iCAAa,CAAC,kBAAkB,CAAC;YACjC,8BAAU;6CAWsB,6BAAS,EAAyB,iCAAa,EAAmB,OAAO,EAA6B,qCAAiB,EAA6B,qCAAiB;WAVzL,4BAA4B,CA6FxC;QAAD,mCAAC;KA7FD,AA6FC,IAAA;IA7FY,oEAA4B;;;;;;;ICGzC,SAAgB,SAAS,CAAC,OAAgB;QAExC,IAAM,cAAc,GAAG,4BAAQ,CAAC,MAAM,CAAC,qBAAqB,CAAA;QAC5D,OAAO,CAAC,GAAG;aACR,kBAAkB,EAAE;aACpB,MAAM,CAAC,gBAAgB,CAAC;aACxB,MAAM,CAAC,2BAA2B,CAAC,CAAC;QAEvC,CAAC,uBAAuB,EAAE,cAAc,CAAC,CAAC,OAAO,CAAC,UAAA,CAAC;YACjD,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;QACxB,CAAC,CAAC,CAAA;QAEF,IAAI,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,EAAE;YACjC,cAAc,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,EAAtB,CAAsB,CAAC,CAAA;SACpD;QACD,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,+CAA4B,EAAE,yCAA0B,EAAE,uCAAwB,EAAE,wCAAwB,EAAE,+CAA6B,EAAC,sDAA+B,EAAC,qCAAuB,CAAC,CAAC,CAAA;QAElO,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,qBAAW,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;QAErE,IAAI,qBAAW,CAAC,OAAO,EAAE;YACvB,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;SACvC;QAED,OAAO,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,cAAM,OAAA,OAAO,CAAC,OAAO,EAAE,EAAjB,CAAiB,CAAC,CAAC;QAC9C,4BAAQ,CAAC,MAAM,CAAC,gBAAgB,GAAG,UAAU,EAAU;YAEtD,IAAI,IAAI,GAAQ,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAA;YAC3C,IAAI,IAAI,EAAE;gBACT,GAAG;oBACF,IAAI,IAAI,CAAC,EAAE,EAAE;wBACZ,OAAO,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,gBAAgB,IAAI,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAA;qBACpF;oBACD,IAAI,GAAG,IAAI,CAAC,UAAU,CAAA;iBACtB,QAAQ,IAAI,EAAC;gBACd,OAAO,SAAS,CAAA;aAChB;QAEH,CAAC,CAAA;IACF,CAAC;IAtCD,8BAsCC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IC5CD,IAAM,IAAI,GAAG,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,cAAc,EAAE,GAAG,CAAC,CAAA;IAE/E;QAOE,+BAAoB,MAAkB;YAAlB,WAAM,GAAN,MAAM,CAAY;YAJ/B,kBAAa,GAAY,KAAK,CAAA;YAKnC,IAAM,KAAK,GAAG,IAAI,CAAA;YAClB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,UAAA,MAAM;gBAE1B,MAAM,CAAC,eAAe,CAAC;oBACrB,OAAO,YAAC,OAAO;wBACb,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,YAAU,KAAK,CAAC,gBAAkB,CAAC,CAAA;wBACxE,OAAO,OAAO,CAAA;oBAChB,CAAC;oBACD,QAAQ,YAAC,QAAQ,EAAE,OAAO;wBACxB,IAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,CAAA;wBAExC,IAAI,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;4BACzD,OAAO,QAAQ,CAAA;yBAChB;wBACD,IAAI,QAAQ,CAAC,UAAU,IAAI,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE;4BAC3E,KAAK,CAAC,aAAa,GAAG,KAAK,CAAA;4BAC3B,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAA;yBACrC;6BAAM;4BACL,OAAO,QAAQ,CAAA;yBAChB;oBACH,CAAC;iBACF,CAAC,CAAA;YACJ,CAAC,CAAC,CAAA;QACJ,CAAC;QAED,4CAAY,GAAZ,UAAa,KAAa;YACxB,IAAI,CAAC,gBAAgB,GAAG,KAAK,CAAA;QAC/B,CAAC;QAEK,gDAAgB,GAAtB;;;;oBACE,WAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,6BAA6B,CAAC;6BACpD,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,OAAI,CAAC,aAAa,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,EAAhD,CAAgD,CAAC;6BAC3D,KAAK,CAAC,UAAA,CAAC,IAAI,OAAA,OAAI,CAAC,aAAa,GAAG,KAAK,EAA1B,CAA0B,CAAC,EAAA;;;SAE1C;QAEK,+CAAe,GAArB,UAAsB,KAAa;;;;;oBACjC,IAAI,CAAC,gBAAgB,GAAG,KAAK,CAAA;oBAGvB,MAAM,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,IAAO,QAAQ,GAAG,OAAO,CAAC,CAAC,cAAc,GAAG,MAAM,CAAA,CAAC,CAAC,CAAC,CAAA;oBAI1F,QAAQ,GAAG,IAAI,QAAQ,EAAE,CAAC;oBAChC,QAAQ,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;oBAEhD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,sCAAoC,IAAI,YAAS,EAAE;wBACnE,MAAM,EAAE,MAAM;wBACd,IAAI,EAAE,QAAQ;qBACf,CAAC,CAAC,IAAI,CAAC,UAAM,eAAe;;;4BAE3B,IAAI,eAAe,CAAC,UAAU,EAAE;gCAE9B,IAAI,eAAe,CAAC,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE;oCAE3C,IAAI,CAAC,aAAa,GAAG,IAAI,CAAA;oCACzB,QAAQ,EAAE,CAAA;iCACX;qCAAM;oCACL,IAAI,CAAC,aAAa,GAAG,KAAK,CAAA;oCAC1B,IAAI,eAAe,CAAC,GAAG,CAAC,iBAAiB,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE;wCAC3D,MAAM,GAAG,IAAI,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,CAAA;wCAC3C,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,aAAa,CAAC,CAAA;qCACnD;oCAED,cAAc,EAAE,CAAA;iCACjB;6BACF;;;yBAEF,CAAC,CAAA;oBAEF,WAAO,MAAM,EAAA;;;SACd;QAEK,6CAAa,GAAnB,UAAoB,QAAgB,EAAE,QAAgB,EAAE,OAAsB,EAAE,MAAqB;YAA7C,wBAAA,EAAA,cAAsB;YAAE,uBAAA,EAAA,aAAqB;;;;oBAInG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,0BAA0B,EAAE;wBAC5C,MAAM,EAAE,MAAM;wBACd,IAAI,EAAE,2BAAI,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;qBACtF,CAAC;yBACC,IAAI,CAAC,UAAC,CAAC;wBAEN,IAAI,CAAC,CAAC,EAAE,EAAE;4BACR,OAAI,CAAC,aAAa,GAAG,IAAI,CAAA;yBAC1B;6BAAM;4BACL,OAAI,CAAC,aAAa,GAAG,KAAK,CAAA;yBAC3B;oBAEH,CAAC,CAAC,CAAA;;;;SAGL;QACK,qCAAK,GAAX,UAAY,QAAgB,EAAE,QAAgB,EAAE,OAAsB,EAAE,MAAqB;YAA7C,wBAAA,EAAA,cAAsB;YAAE,uBAAA,EAAA,aAAqB;;;;;;;iCAEvF,CAAA,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,gBAAgB,CAAA,EAAnC,cAAmC;;;;4BAEnC,WAAM,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAA;;4BAAjD,SAAiD,CAAA;;;;;gCAMrD,WAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,kCAAgC,IAAI,CAAC,IAAM,EAAE;gCACpE,MAAM,EAAE,MAAM;gCACd,IAAI,EAAE,2BAAI,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;6BACtF,CAAC;iCACC,IAAI,CAAC,UAAC,CAAC;gCACN,OAAI,CAAC,IAAI,GAAG,SAAS,CAAA;gCACrB,IAAI,CAAC,CAAC,EAAE,EAAE;oCACR,OAAI,CAAC,aAAa,GAAG,IAAI,CAAA;iCAC1B;qCAAM;oCACL,OAAI,CAAC,aAAa,GAAG,KAAK,CAAA;iCAC3B;4BAEH,CAAC,CAAC,EAAA;;;;SAGL;QAED,wCAAQ,GAAR;YACE,IAAI,CAAC,aAAa,GAAG,KAAK,CAAA;QAC5B,CAAC;QAnIU,qBAAqB;YADjC,8BAAU;6CAQmB,iCAAU;WAP3B,qBAAqB,CAoIjC;QAAD,4BAAC;KApID,AAoIC,IAAA;IApIY,sDAAqB;;;;;;;;;;;;;;;;ICHlC,IAAI,OAAO,GAAG,mBAAmB,CAAA;IAGjC;QAGE,yBAAoB,MAAkB;YAAlB,WAAM,GAAN,MAAM,CAAY;QAEtC,CAAC;QAED,yCAAe,GAAf,UAAgB,QAAgB;YAC9B,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAI,OAAO,SAAI,QAAU,CAAC;iBAC/C,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,EAAE,EAAR,CAAQ,CAAC,CAAA;QACxB,CAAC;QAED,wCAAc,GAAd,UAAe,QAAgB,EAAE,IAAQ;YACvC,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAI,OAAO,SAAI,QAAU,EAC/C;gBACE,MAAM,EAAE,MAAM;gBACd,IAAI,EAAE,2BAAI,CAAC,IAAI,CAAC;aACjB,CAAC,CAAC,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,EAAE,EAAR,CAAQ,CAAC,CAAA;QAC1B,CAAC;QAlBU,eAAe;YAD3B,8BAAU;6CAImB,iCAAU;WAH3B,eAAe,CAmB3B;QAAD,sBAAC;KAnBD,AAmBC,IAAA;IAnBY,0CAAe;IAsB5B;QACE,wBAAoB,MAAkB;YAAlB,WAAM,GAAN,MAAM,CAAY;QAEtC,CAAC;QAED,sCAAa,GAAb,UAAc,OAAe;YAC3B,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAI,OAAO,oBAAe,OAAS,CAAC;iBACzD,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,EAAE,EAAR,CAAQ,CAAC,CAAA;QACxB,CAAC;QARU,cAAc;YAD1B,8BAAU;6CAEmB,iCAAU;WAD3B,cAAc,CAS1B;QAAD,qBAAC;KATD,AASC,IAAA;IATY,wCAAc;IAY3B;QAAA;QAIA,CAAC;QAHC,+BAAU,GAAV,UAAW,UAAkB;YAC3B,OAAO,GAAG,UAAU,CAAA;QACtB,CAAC;QACH,iBAAC;IAAD,CAJA,AAIC,IAAA;IAJY,gCAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICrCvB,IAAM,SAAS,GAAG,WAAW,CAAA;IAG7B;QAAA;YACE,gBAAW,GAAO,EAAE,CAAA;YACpB,YAAO,GAAO,EAAE,CAAA;QAKlB,CAAC;QAHC,6BAAQ,GAAR,UAAS,EAAmC,EAAE,KAAc;YAC1D,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,KAAK,CAAA;QAC7C,CAAC;QANU,UAAU;YADtB,6BAAS,CAAC,aAAa,CAAC;WACZ,UAAU,CAOtB;QAAD,iBAAC;KAPD,AAOC,IAAA;IAPY,gCAAU;IAWvB;QAWE,oBAAoB,eAAgC,EAAU,UAAsB,EAAU,eAAgC,EAAU,aAA4B,EAAU,EAAa;YAA3L,iBASC;YATmB,oBAAe,GAAf,eAAe,CAAiB;YAAU,eAAU,GAAV,UAAU,CAAY;YAAU,oBAAe,GAAf,eAAe,CAAiB;YAAU,kBAAa,GAAb,aAAa,CAAe;YAAU,OAAE,GAAF,EAAE,CAAW;YAP3L,mBAAc,GAAO,EAAE,CAAA;YACvB,gBAAW,GAAO,EAAE,CAAA;YAIpB,sBAAiB,GAAiB,EAAE,CAAA;YAGlC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,iBAAiB,EAAE,UAAC,CAAC;gBAElD,KAAI,CAAC,EAAE,CAAC,mBAAmB,EAAE,CAAC;gBAC9B,KAAI,CAAC,EAAE,CAAC,SAAS,CAAC;oBAChB,KAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAA;gBACtB,CAAC,CAAC,CAAA;YACJ,CAAC,CAAC,CAAA;QAEJ,CAAC;QAED,gCAAW,GAAX,UAAY,QAAoB,EAAE,IAAY,EAAE,KAAa;YAE3D,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACxC,IAAM,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;gBAC5B,IAAI,OAAO,CAAC,KAAK,KAAK,KAAK,IAAI,OAAO,CAAC,IAAI,KAAK,IAAI;oBAAE,OAAO,OAAO,CAAA;gBACpE,IAAI,OAAO,CAAC,QAAQ,EAAE;oBACpB,IAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,QAAQ,EAAE,IAAI,EAAE,KAAK,CAAC,CAAA;oBAC7D,IAAI,KAAK,EAAE;wBACT,OAAO,KAAK,CAAA;qBACb;iBACF;aAEF;YACD,OAAO,SAAS,CAAA;QAClB,CAAC;QAEK,+BAAU,GAAhB,UAAiB,QAAgB,EAAE,eAAyB;;;;oBAC1D,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,EAAE,CAAA;oBAChC,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,EAAE,CAAA;oBAC5B,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAA;oBAClB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAA;oBACxB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAA;oBAClB,WAAO,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,QAAQ,CAAC;6BAIlD,IAAI,CAAC,UAAA,CAAC;4BACL,KAAI,CAAC,QAAQ,GAAG,CAAC,CAAC,QAAQ,CAAA;4BAI1B,KAAI,CAAC,UAAU,CAAC,WAAW,GAAG,CAAC,CAAC,WAAW,CAAA;4BAC3C,KAAI,CAAC,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAA;4BAC/D,KAAI,CAAC,UAAU,CAAC,OAAO,GAAG,CAAC,CAAC,OAAO,CAAA;4BAInC,KAAK,IAAI,QAAQ,IAAI,CAAC,CAAC,WAAW,EAAE;gCAClC,IAAI,CAAC,CAAC,WAAW,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;oCAC1C,IAAM,UAAU,GAAG,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAA;oCAC1C,KAAK,IAAI,SAAS,IAAI,UAAU,EAAE;wCAChC,IAAI,UAAU,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;4CAExC,IAAI,YAAY,GAAG,KAAK,CAAA;4CAExB,IAAM,OAAO,GAAG,KAAI,CAAC,WAAW,CAAC,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAA;4CACjE,IAAI,OAAO,EAAE;gDACX,IAAM,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;gDACpC,IAAI,MAAM,IAAI,MAAM,CAAC,YAAY,EAAE;oDACjC,YAAY,GAAG,IAAI,CAAA;iDACpB;6CACF;4CACD,IAAM,EAAE,GAAG,KAAI,CAAC,qBAAqB,CAAC,QAAQ,EAAE,SAAS,EAAE,YAAY,CAAC,CAAA;4CACxE,KAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,KAAI,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,SAAS,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,CAAA;yCACjI;qCACF;iCAKF;6BACF;4BACD,KAAI,CAAC,MAAM,GAAG,KAAK,CAAA;4BACnB,KAAI,CAAC,eAAe,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAA;wBAChD,CAAC,CAAC,EAAA;;;SACL;QAEK,iCAAY,GAAlB,UAAmB,OAAgB,EAAE,KAAuB;;YAAvB,sBAAA,EAAA,aAAuB;;;;;;;4BAC1D,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;4BAGb,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,WAAW,EAAE,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC,CAAA;4BAChF,QAAQ,GAAG,KAAK,CAAA;4BACpB,KAAS,QAAQ,IAAI,QAAQ,CAAC,IAAI,EAAE;gCAClC,IAAI,QAAQ,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;oCACpC,UAAU,GAAG,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;oCAC1C,KAAS,SAAS,IAAI,UAAU,EAAE;wCAChC,IAAI,UAAU,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;4CACxC,QAAQ,GAAG,IAAI,CAAA;4CACf,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAA;4CACrF,MAAK;yCACN;qCACF;iCACF;6BACF;4BAED,IAAI,CAAC,QAAQ,IAAI,CAAC,OAAO,IAAI,CAAC,KAAK,EAAE;gCACnC,WAAM;6BACP;4BAEe,WAAM,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAA;;4BAA5E,OAAO,GAAG,SAAkE;4BAElF,IAAI,OAAO,CAAC,QAAQ,IAAI,SAAS,EAAE;gCACjC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAA;gCAC/D,SAAS,GAAG,OAAO,CAAC,WAAW,CAAA;gCAErC,KAAS,QAAQ,IAAI,SAAS,EAAE;oCAC9B,IAAI,SAAS,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;wCAChC,UAAU,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAA;wCACtC,KAAS,SAAS,IAAI,UAAU,EAAE;4CAChC,IAAI,UAAU,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;gDACpC,YAAY,GAAG,KAAK,CAAA;gDACxB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;oDACzD,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAA;iDAE3C;gDACD,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;oDACpE,YAAY,GAAG,IAAI,CAAA;iDAEpB;gDAED,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,GAAG,UAAU,CAAC,SAAS,CAAC,CAAA;gDACxE,IAAI,YAAY,EAAE;oDACZ,YAAY,GAAG,KAAK,CAAA;oDAClB,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,QAAQ,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAA;oDACvE,IAAI,OAAO,EAAE;wDACL,MAAM,GAAG,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;wDAC1C,IAAI,MAAM,IAAI,MAAM,CAAC,YAAY,EAAE;4DACjC,YAAY,GAAG,IAAI,CAAA;yDAEpB;qDACF;oDACK,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,QAAQ,EAAE,SAAS,EAAE,YAAY,CAAC,CAAA;oDACxE,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,SAAS,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,CAAA;iDACpG;6CACF;yCACF;qCAKF;iCACF;gCACD,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAA;oDAChC,CAAC;oCACR,IAAI,CAAC,GAAG,OAAK,QAAQ,CAAC,CAAC,CAAC,CAAA;oCAExB,IAAI,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,CAAC,QAAQ,EAAE;wCAC7B,IAAM,EAAE,GAAG,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,EAAZ,CAAY,CAAC,CAAA;wCACnD,IAAI,EAAE,CAAC,QAAQ,IAAI,EAAE,CAAC,QAAQ,CAAC,MAAM,YAAK,CAAC,CAAC,QAAQ,0CAAE,MAAM,CAAA;4CAC1D,CAAC,CAAC,QAAQ,GAAG,EAAE,CAAC,QAAQ,CAAA;qCAC3B;;;gCAPH,KAAS,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE;4CAApC,CAAC;iCAQT;6BAEF;4BACD,IAAI,CAAC,EAAE,CAAC,mBAAmB,EAAE,CAAA;4BAC7B,IAAI,CAAC,WAAW,GAAG,EAAE,CAAA;4BACrB,IAAI,OAAO,CAAC,aAAa,EAAE;gCACzB,IAAI,OAAO,CAAC,aAAa,IAAI,CAAC,EAAE;oCAC9B,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAA;oCAC/C,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAA;oCAC/B,aAAa,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAA;oCAC1C,IAAI,CAAC,sBAAsB,GAAG,WAAW,CAAC,cAAQ,KAAI,CAAC,YAAY,CAAC,SAAS,EAAE,IAAI,CAAC,CAAA,CAAC,CAAC,EAAE,IAAI,CAAC,CAAA;oCAC7F,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAA;iCACzC;qCAAM,IAAI,OAAO,CAAC,aAAa,GAAG,CAAC,EAAE;oCACpC,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAA;oCAC9B,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAA;oCAC/C,aAAa,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAA;iCAC3C;6BACF;4BACD,IAAI,CAAC,MAAM,GAAG,KAAK,CAAA;4BACnB,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAA;;;;;SAC/C;QAYD,kCAAa,GAAb;YACE,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,EAAE,CAAA;YAChC,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,EAAE,CAAA;YAC5B,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAA;YAClB,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,UAAA,CAAC,IAAE,OAAA,CAAC,CAAC,OAAO,EAAE,EAAX,CAAW,CAAC,CAAA;YAC9C,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAA;QAC7B,CAAC;QAED,mCAAc,GAAd,UAAe,OAAY;YACzB,IAAI,CAAC,EAAE,CAAC,mBAAmB,EAAE,CAAC;YAC9B,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,iBAAiB,EAAE,OAAO,CAAC,CAAA;QAC1D,CAAC;QAED,0CAAqB,GAArB,UAAsB,QAAgB,EAAE,SAAiB,EAAE,YAAqB;YAAhF,iBAoBC;YAjBC,OAAO,UAAC,QAAQ,EAAE,QAAQ;gBACxB,IAAI,CAAC,KAAI,CAAC,MAAM,EAAE;oBAChB,IAAI,CAAC,KAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE;wBAC/B,KAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAA;qBAChC;oBACD,KAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,GAAG,QAAQ,CAAA;oBAGhD,IAAI,KAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,KAAK,KAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,EAAE;wBACtF,OAAO,KAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAA;qBAC7C;oBAED,IAAI,YAAY,EAAE;wBAChB,KAAI,CAAC,YAAY,EAAE,CAAA;qBACpB;iBACF;YACH,CAAC,CAAA;QACH,CAAC;QArOU,UAAU;YADtB,8BAAU;6CAY4B,0CAAe,EAAsB,UAAU,EAA2B,mCAAe,EAAyB,iCAAa,EAAc,6BAAS;WAXhL,UAAU,CAsOtB;QAAD,iBAAC;KAtOD,AAsOC,IAAA;IAtOY,gCAAU","file":"apps/outlook-plugin/app-bundle.js","sourcesContent":["import { HttpClient, json } from 'aurelia-fetch-client'\r\nimport { autoinject, observable, TaskQueue, PLATFORM } from 'aurelia-framework'\r\nimport { EventAggregator } from 'aurelia-event-aggregator';\r\nimport { ScreenApiClient, ApiManager, LoginApiClient } from './services/screen-api-client';\r\nimport { AuthenticationService } from './services/authentication-service';\r\n\r\ndeclare var requirejs\r\ndeclare var Office: any\r\n\r\n\r\n@autoinject\r\nexport class App {\r\n\r\n\r\n\r\n  @observable\r\n  // signedIn = false;\r\n  initialized = false;\r\n  username: string;\r\n  password: string;\r\n  @observable\r\n  apiType: string\r\n  outlookScreenId: string\r\n  LoginDictionaries: {\r\n    companies: string[]\r\n    locales: { Name: string, DisplayName: string }[]\r\n  };\r\n  @observable\r\n  selectedCompany?: string\r\n  selectedLocale?: string\r\n  constructor(private client: HttpClient, private tasqQueue: TaskQueue, private apiManager: ApiManager, private loginApiClient: LoginApiClient, private authenticationService: AuthenticationService) {\r\n    const _this = this\r\n    const root = requirejs.s.contexts._.config.baseUrl.replace(\"/scripts/ca/\", \"/\")\r\n    this.apiType = 'marina'\r\n    this.apiManager.setApiRoot('newui/look')\r\n    this.outlookScreenId = \"ou201000\"\r\n\r\n    this.LoginDictionaries = PLATFORM.global.LoginDictionaries\r\n\r\n    this.client.configure((client) => {\r\n\r\n      client\r\n        .withBaseUrl(root)\r\n        .withDefaults({\r\n          headers: {\r\n            'Accept': 'application/json',\r\n            'X-Requested-With': 'Fetch'\r\n          },\r\n          credentials: 'same-origin',\r\n\r\n        })\r\n\r\n        .withInterceptor({\r\n\r\n          async response(r) {\r\n            const response = await r.clone()\r\n            const contentType = response.headers.get(\"content-type\");\r\n            if (contentType && contentType.indexOf(\"application/json\") !== -1) {\r\n              const x = await response.json()\r\n              if (x.diffType === \"redirect\") {\r\n                if (x.mode === 1) {\r\n                  if (x.url.indexOf(\"Frames/Outlook/FirstRun.html\") > -1) {\r\n                    _this.authenticationService.lostAuth()\r\n                    throw new Error('Not authenticated')\r\n                  }\r\n                } else if (x.mode === 2) {\r\n                  Office.context.ui.displayDialogAsync(x.url)\r\n                }\r\n              }\r\n            }\r\n            return r\r\n          }\r\n        })\r\n    })\r\n\r\n  }\r\n\r\n  selectedCompanyChanged(newValue, oldValue) {\r\n    if (oldValue) {\r\n      this.loginApiClient.getLocalesFor(newValue)\r\n        .then(l => this.LoginDictionaries.locales = l)\r\n    }\r\n  }\r\n  selectedLocaleChanged(newValue, oldValue) {\r\n    console.log(newValue)\r\n  }\r\n\r\n\r\n  async authUser() {\r\n    let signedIn\r\n    let failedToSignIn\r\n    const result = new Promise((resolve, reject) => { signedIn = resolve; failedToSignIn = reject })\r\n    Office.context.mailbox.getUserIdentityTokenAsync((asyncResult) => {\r\n      this.authenticationService.setUserToken(asyncResult.value)\r\n      this.authenticationService.isUserAssociated()\r\n        .then(x => {\r\n          signedIn()\r\n        })\r\n        .catch(x => {\r\n          failedToSignIn()\r\n        })\r\n    })\r\n    return result\r\n\r\n  }\r\n\r\n  async signInWithToken() {\r\n\r\n    let signedIn\r\n    let failedToSignIn\r\n    const result = new Promise((resolve, reject) => { signedIn = resolve; failedToSignIn = reject })\r\n\r\n    Office.context.mailbox.getUserIdentityTokenAsync((asyncResult) => {\r\n      this.authenticationService.signInWithToken(asyncResult.value)\r\n        .then(x => {\r\n          signedIn()\r\n        })\r\n        .catch(x => {\r\n          failedToSignIn()\r\n        })\r\n    })\r\n    return result\r\n  }\r\n\r\n  async attached() {\r\n    let signalReady\r\n    const appReady = new Promise((r) => { signalReady = r })\r\n\r\n    Office.initialize = () => {\r\n      signalReady()\r\n\r\n\r\n\r\n      this.signInWithToken()\r\n        .then(() => { this.initialized = true })\r\n        .catch(x => { this.initialized = true })\r\n    }\r\n    // await appReady\r\n    // await this.authUser()\r\n    // this.initialized = true\r\n    return appReady\r\n  }\r\n\r\n  async logIn() {\r\n\r\n    await this.authenticationService.logIn(this.username, this.password, this.selectedCompany, this.selectedLocale)\r\n    //await this.authenticationService.associateUser(this.username, this.password, this.selectedCompany, this.selectedLocale)\r\n    if (this.authenticationService.authenticated) {\r\n      this.username = ''\r\n      this.password = ''\r\n    }\r\n  }\r\n\r\n\r\n}\r\n\r\n\r\n",".login-form {\r\n  padding: 12px;\r\n}\r\n\r\n.login-form input,\r\n.login-form button,\r\n.login-form select {\r\n  box-sizing: border-box;\r\n\r\n  width: 100%;\r\n  margin: 6px 0;\r\n  color: rgba(0, 0, 0, 0.64);\r\n  font-size: 19px;\r\n  font-weight: 500;\r\n\r\n  padding: 6px 8px;\r\n  border: solid 1px RGBA(0, 0, 0, 0.12);\r\n  border-radius: 3px;\r\n}\r\n\r\n.login-form input::placeholder {\r\n  font-style: normal;\r\n}\r\n\r\n.login-form button {\r\n  color: #444;\r\n  cursor: pointer;\r\n  padding: 5px;\r\n  background-color: #fff;\r\n\r\n  border: solid 1px #027ACC;\r\n  border-radius: 5px;\r\n  transition: all .1s ease-in-out;\r\n  -webkit-appearance: none;\r\n}\r\n\r\n.login-form button:focus,\r\n.login-form button:hover {\r\n  color: white;\r\n  background-color: #027ACC;\r\n  border: solid 1px #027ACC;\r\n\r\n}\r\n\r\n.login-form button:disabled {\r\n  color: #444;\r\n  cursor: default;\r\n  background-color: #eee;\r\n  border: solid 1px #ccc;\r\n}\r\n","<template>\r\n  <require from=\"./app.css\"></require>\r\n  <require from=\"./controls/containers/screen-container\"></require>\r\n  <div if.bind=\"initialized && apiType\">\r\n    <div if.bind=\"authenticationService.authenticated\" style=\"background-color: white;\">\r\n      <qp-screen-container config.bind=\"{screenId:outlookScreenId}\">\r\n      </qp-screen-container>\r\n    </div>\r\n    <form else class='login-form'>\r\n     \r\n      <select value.bind=\"selectedLocale\"  id=\"cmbLang\" if.bind=\"LoginDictionaries.locales && LoginDictionaries.locales.length > 1\" style=\"margin-bottom:32px;\">\r\n        <option repeat.for=\"locale of LoginDictionaries.locales\"\r\n                model.bind=\"locale.Name\">\r\n          ${locale.DisplayName}\r\n        </option>\r\n      </select>\r\n      <br/><br/>\r\n      <input type=\"text\" name=\"username\" value.bind=\"username\" id=\"txtUser\" required placeholder=\"My Username\">\r\n      <input type=\"password\" value.bind=\"password\" id=\"txtPass\" required placeholder=\"My Password\">\r\n      \r\n      <select value.bind=\"selectedCompany\" id=\"cmbCompany\" if.bind=\"LoginDictionaries.companies && LoginDictionaries.companies.length > 1\" style=\"margin-top:32px;\">       \r\n        <option repeat.for=\"company of LoginDictionaries.companies\" value.bind=\"company\">${company}</option>\r\n          \r\n        \r\n      </select>\r\n      <button click.delegate=\"logIn()\" disabled.bind=\"!username || !password\" id=\"btnLogin\" type=\"submit\">Sign In</button>\r\n    </form>\r\n  </div>\r\n</template>\r\n","import { bindable, bindingMode, computedFrom, customElement } from \"aurelia-framework\";\r\n\r\n@customElement(\"qp-labeled-control\")\r\nexport class QpLabeledControlCustomElement {\r\n  @bindable controlConfig\r\n  @bindable({ defaultBindingMode: bindingMode.twoWay }) controlValue\r\n  @bindable controlType = undefined\r\n\r\n\r\n  @computedFrom('controlConfig.displayName', 'controlConfig.action','controlConfig.suppressLabel')\r\n  get label() {\r\n    if(this.controlConfig?.suppressLabel){\r\n      return undefined\r\n    }\r\n    if (this.controlConfig?.action) {\r\n      return undefined\r\n    }\r\n    return this.controlConfig?.displayName\r\n  }\r\n}\r\n",".labeled-control__control .qp-text-editor {\r\n  width: 100%;\r\n}\r\n.labeled-control__control .qp-button{\r\n  width:100%;\r\n}\r\n","<template>\r\n  <require from=\"./labeled-control.css\"></require>\r\n  <div style=\"display:flex; margin: 5px;\" if.bind=\"controlConfig.visible === undefined  || controlConfig.visible !== false\">\r\n    <div if.bind=\"controlType == 'qp-label-fake'\" style=\"flex:1 0 100px;\"  class=\"labeled-control__label\">\r\n      <label id=\"${controlConfig.id}\">${label}</label>\r\n    </div>\r\n    <template else>\r\n      <div style=\"flex:0 0 100px;\" if.bind=\"label\" class=\"labeled-control__label\">\r\n        <label>${label}</label>\r\n      </div>\r\n      <div style=\"flex:1 0 180px;\">\r\n        <enhanced-compose view-model.bind=\"controlType\" class=\"labeled-control__control\" value.two-way=\"controlValue\"\r\n          config.bind='controlConfig'>\r\n        </enhanced-compose>\r\n      </div>\r\n    </template>\r\n  </div>\r\n</template>\r\n","import { IControl } from \"apps/outlook-plugin/services/screen-api-client\";\r\nimport { EventAggregator } from \"aurelia-event-aggregator\";\r\nimport { autoinject, customElement, bindable, Disposable } from \"aurelia-framework\";\r\nimport { ScreenData } from \"../../services/screen-data\";\r\n\r\n@autoinject\r\n@customElement(\"qp-fieldset\")\r\nexport class QpFieldsetCustomElement {\r\n\r\n  @bindable controls: IControl[]\r\n  @bindable config: { visible: boolean }[]\r\n  \r\n  updateSubscription: Disposable;\r\n\r\n  hasVisibleControls: boolean = false\r\n  constructor(private screenData: ScreenData, private eventAggregator: EventAggregator) {\r\n    \r\n\r\n  }\r\n  attached() {\r\n    \r\n    this.updateSubscription = this.eventAggregator.subscribe(\"screen-updated\", () => {\r\n      \r\n      this.hasVisibleControls = this.controls.some(c => this.screenData.configs[c.id].visible)\r\n    })\r\n  }\r\n  detached() {\r\n    this.updateSubscription?.dispose()\r\n  }\r\n}\r\n\r\n\r\n","<template>\r\n  <fieldset if.bind=\"hasVisibleControls\">\r\n    <legend if.bind=\"config.displayName\">${config.displayName}</legend>\r\n    <div repeat.for=\"con of controls\">\r\n      <template if.bind=\"con.controls\">\r\n\r\n        <enhanced-compose controls.bind=\"con.controls\" view-model.bind=\"con.type\"\r\n          config.bind='screenData.configs[con.id]'>\r\n        </enhanced-compose>\r\n\r\n      </template>\r\n      <template else>\r\n        <qp-labeled-control control-config.bind=\"screenData.configs[con.id]\" control-value.two-way=\"screenData.fieldValues[con.view][con.field]\"\r\n        control-type.bind=\"con.type\"></qp-labeled-control>\r\n\r\n      </template>\r\n    </div>\r\n  </fieldset>\r\n</template>\r\n","import { customElement, autoinject, bindable } from \"aurelia-framework\";\r\nimport { QpContainerCustomElement } from \"../qp-container\";\r\nimport { ScreenInfo, ScreenData } from \"apps/outlook-plugin/services/screen-data\";\r\n\r\n@customElement(\"qp-screen-container\")\r\n@autoinject\r\nexport class QpScreenContainerCustomElement {\r\n\r\n\r\n\r\n  @bindable config\r\n  constructor(private screenInfo: ScreenInfo, private screenData: ScreenData) {\r\n\r\n  }\r\n\r\n  configChanged(newValue) {\r\n\r\n  }\r\n  attached() {\r\n    return this.screenInfo.initScreen(this.config.screenId)\r\n\r\n  }\r\n  detached(){\r\n    return this.screenInfo.destroyScreen()\r\n  }\r\n}\r\n","<template>\r\n  <div style=\"display: flex;flex-flow:column;height:100vh;\">\r\n    <template repeat.for=\"con of screenInfo.controls\">\r\n      <div if.bind=\"con.id=='action:logOut'\" style=\"flex:1 1 auto;\"></div>\r\n      <div>\r\n\r\n        <template if.bind=\"con.controls\">\r\n          <enhanced-compose controls.bind=\"con.controls\" view-model.bind=\"con.type\" config.bind='screenData.configs[con.id]'></enhanced-compose>\r\n        </template>\r\n        <template else>\r\n          <qp-labeled-control control-config.bind=\"screenData.configs[con.id]\" control-value.two-way=\"screenData.values[con.view][con.field]\" control-type.bind=\"con.type\"></qp-labeled-control>\r\n        </template>\r\n      </div>\r\n    </template>\r\n  </div>\r\n  <div style=\"position:fixed;top:0;height:100%;width:100%;cursor: wait;\" class=\"api-call-in-progress\" if.bind=\"screenInfo.saving\"></div>\r\n</template>\r\n","export class QpVerticalStackContainerCustomElement {\r\n  \r\n}\r\n","<template>\r\n  \r\n</template>\r\n","import { Container, autoinject, customElement, bindable, TaskQueue } from 'aurelia-framework'\r\nimport { ScreenData } from 'apps/outlook-plugin/services/screen-data'\r\nimport { EventAggregator } from 'aurelia-event-aggregator'\r\n\r\ndeclare var Office\r\n\r\n@autoinject\r\n@customElement('qp-outlook-data')\r\nexport class QpOutlookDataCustomElement {\r\n  @bindable config: IOutlookDataConfig\r\n  @bindable value\r\n\r\n  serialized: string\r\n  ran = false\r\n  tokenUpdateInterval: number\r\n  constructor(private container: Container, private screenData: ScreenData, private taskQueue: TaskQueue, private eventAggregator: EventAggregator) {\r\n\r\n\r\n  }\r\n\r\n  configChanged(n, o) {\r\n\r\n  }\r\n\r\n\r\n  attached() {\r\n\r\n    // if (o === undefined && !this.ran) {\r\n    // this.ran = true\r\n    this.taskQueue.queueTask(() => { this.updateValue() })\r\n    // }\r\n\r\n    // this.serialized = JSON.stringify(message, null, 2)\r\n\r\n    // this.screenData.setValue(\"ContactLastName\", message.sender.displayName)\r\n\r\n\r\n    // this.screenData.setValue(\"ContactDisplayName\", message.sender.displayName)\r\n\r\n  }\r\n  updateValue() {\r\n    const message = Office.context.mailbox.item\r\n    this.serialized = JSON.stringify(message, null, 2)\r\n    if (!message) {\r\n      return\r\n    }\r\n\r\n    if (this.config.fieldsMap) {\r\n      if (this.config.fieldsMap.isIncome) {\r\n        this.screenData.setValue(this.config.fieldsMap.isIncome, true)\r\n      }\r\n      if (this.config.fieldsMap.emailAddress) {\r\n        this.screenData.setValue(this.config.fieldsMap.emailAddress, message.sender.emailAddress)\r\n      }\r\n\r\n      if (this.config.fieldsMap.displayName) {\r\n        this.screenData.setValue(this.config.fieldsMap.displayName, message.sender.displayName)\r\n      }\r\n\r\n      if (this.config.fieldsMap.newFirstName) {\r\n        this.screenData.setValue(this.config.fieldsMap.newFirstName, getFirstName(message.sender.displayName))\r\n      }\r\n\r\n      if (this.config.fieldsMap.newLastName) {\r\n        this.screenData.setValue(this.config.fieldsMap.newLastName, getLastName(message.sender.displayName))\r\n      }\r\n\r\n      if (message.sender.emailAddress == \"\" || message.sender.emailAddress == Office.context.mailbox.userProfile.emailAddress) {\r\n        if (this.config.fieldsMap.isIncome) {\r\n          this.screenData.setValue(this.config.fieldsMap.isIncome, false)\r\n        }\r\n\r\n        if (this.config.fieldsMap.displayName) {\r\n          this.screenData.setValue(this.config.fieldsMap.displayName, \"\")\r\n        }\r\n\r\n        if (this.config.fieldsMap.newFirstName) {\r\n          this.screenData.setValue(this.config.fieldsMap.newFirstName, \"\")\r\n        }\r\n\r\n        if (this.config.fieldsMap.newLastName) {\r\n          this.screenData.setValue(this.config.fieldsMap.newLastName, \"\")\r\n        }\r\n      }\r\n\r\n\r\n      if (this.config.fieldsMap.messageId) {\r\n        this.screenData.setValue(this.config.fieldsMap.messageId, message.internetMessageId)\r\n      }\r\n      if (this.config.fieldsMap.subject) {\r\n        this.screenData.setValue(this.config.fieldsMap.subject, message.subject)\r\n      }\r\n      if (this.config.fieldsMap.itemId) {\r\n        this.screenData.setValue(this.config.fieldsMap.itemId, message.itemId)\r\n      }\r\n      if (this.config.fieldsMap.to) {\r\n        this.screenData.setValue(this.config.fieldsMap.to, serializeAddressList(message.to))\r\n      }\r\n      if (this.config.fieldsMap.cC) {\r\n        this.screenData.setValue(this.config.fieldsMap.cC, serializeAddressList(message.cc))\r\n      }\r\n      if (this.config.fieldsMap.ewsUrl) {\r\n        this.screenData.setValue(this.config.fieldsMap.ewsUrl, Office.context.mailbox.ewsUrl)\r\n      }\r\n      if (this.config.fieldsMap.attachmentNames) {\r\n\r\n        const names = (message.attachments as any[]).filter(function (a) {\r\n          return a.contentType === 'application/pdf' ||\r\n            a.contentType === 'application/x-pdf' ||\r\n            a.contentType === 'application/octet-stream' &&\r\n            a.name.toLowerCase().lastIndexOf('.pdf') === a.name.length - 4;\r\n        }).map(function (a) { return a.name })\r\n        \r\n\r\n        this.screenData.setValue(this.config.fieldsMap.attachmentsCount, names.length)\r\n        this.screenData.setValue(this.config.fieldsMap.attachmentNames, names.join(';') + ';')\r\n      }\r\n\r\n\r\n      Office.context.mailbox.getCallbackTokenAsync(\r\n        (asyncResult) => {\r\n          // debugger\r\n          if (asyncResult.status === \"succeeded\") {\r\n\r\n            if (this.config.fieldsMap.apiToken) {\r\n              this.screenData.setValue(this.config.fieldsMap.apiToken, asyncResult.value)\r\n            }\r\n          }\r\n          this.eventAggregator.publish(\"execute-command\")\r\n        });\r\n\r\n        clearInterval(this.tokenUpdateInterval)\r\n        this.tokenUpdateInterval = setInterval(()=>{\r\n\r\n          Office.context.mailbox.getCallbackTokenAsync(\r\n            (asyncResult) => {\r\n              if (asyncResult.status === \"succeeded\") {\r\n                if (this.config.fieldsMap.apiToken) {\r\n                  this.screenData.setValue(this.config.fieldsMap.apiToken, asyncResult.value)\r\n                }\r\n              }\r\n              \r\n            });\r\n        },60000)\r\n\r\n    }\r\n  }\r\n}\r\n// <script src=\"//appsforoffice.microsoft.com/lib/1.1/hosted/office.js\" type=\"text/javascript\"></script>\r\ninterface IOutlookDataConfig {\r\n  [k: string]: any\r\n}\r\n\r\n\r\nfunction serializeAddressList(list) {\r\n  var msg = \"\";\r\n  if (list != null)\r\n    list.forEach(function (recip, index) {\r\n      msg = msg + \"\\\"\" + recip.displayName + \"\\\"\" + \" <\" + recip.emailAddress + \">;\";\r\n    });\r\n  return msg;\r\n}\r\n\r\nfunction getFirstName(displayName) {\r\n  displayName = displayName.trim();\r\n  while (displayName.indexOf(\"  \") > -1)\r\n    displayName = displayName.replace(\"  \", \" \");\r\n  let names = displayName.split(\" \");\r\n  let firstName = names.length > 1 ? names[0] : null;\r\n  return firstName;\r\n}\r\n\r\nfunction getLastName(displayName) {\r\n  displayName = displayName.trim();\r\n  while (displayName.indexOf(\"  \") > -1)\r\n    displayName = displayName.replace(\"  \", \" \");\r\n  let names = displayName.split(\" \");\r\n  let lastName = names.length > 1 ? names[names.length - 1] : names[0];\r\n  return lastName;\r\n}\r\n","<template>\r\n\r\n</template>\r\n","import { customElement, autoinject, bindable } from \"aurelia-framework\";\r\nimport { ScreenInfo } from \"../services/screen-data\";\r\n\r\n\r\n@customElement(\"qp-command-button\")\r\n\r\n@autoinject\r\nexport class QpCommandButtonCustomElement {\r\n  @bindable config\r\n  constructor(private screenData: ScreenInfo) {\r\n\r\n  }\r\n\r\n  click() {\r\n    this.screenData.executeCommand(this.config.command || this.config.action)\r\n  }\r\n}\r\n","<template >\r\n  <button style=\"\r\n  width:100%;\r\n  color: #333;\r\n  font-family: 'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;\r\n  font-size: 14px;\r\n  font-weight: 400;\r\n  box-sizing: border-box;\r\n  margin: 0;\r\n  box-shadow: none;\r\n  background-color: #f4f4f4;\r\n  border: 1px solid #f4f4f4;\r\n  cursor: pointer;\r\n  display: inline-block;\r\n  height: 2pc;\r\n  min-width: 5pc;\r\n  padding: 4px 20px 6px;\" if.bind=\"config.visible\" click.delegate=\"click()\" disabled.bind=\"config.disabled\">${config.DisplayName || config.displayName|| config.id}</button> \r\n</template>\r\n\r\n\r\n\r\n","import { autoinject, customElement, bindable } from \"aurelia-framework\";\r\nimport { ScreenData } from \"../services/screen-data\";\r\n\r\n@autoinject\r\n@customElement(\"qp-container\")\r\nexport class QpContainerCustomElement {\r\n\r\n  @bindable controls\r\n  constructor(private screenData: ScreenData) {\r\n    \r\n\r\n  }\r\n}\r\n\r\n\r\n","<template>\r\n  <div>\r\n    <div repeat.for=\"con of controls\">\r\n      <template if.bind=\"con.controls\">\r\n\r\n        <enhanced-compose controls.bind=\"con.controls\" view-model.bind=\"con.type\"\r\n          config.bind='screenData.configs[con.id]'>\r\n        </enhanced-compose>\r\n\r\n      </template>\r\n      <template else>\r\n        <qp-labeled-control control-config.bind=\"screenData.configs[con.id]\" control-value.two-way=\"screenData.fieldValues[con.view][con.field]\"\r\n        control-type.bind=\"con.type\"></qp-labeled-control>\r\n\r\n      </template>\r\n    </div>\r\n  </div>\r\n</template>\r\n","import { customElement, noView } from \"aurelia-framework\";\r\n\r\n@noView\r\n@customElement(\"qp-label-fake\")\r\nexport class QpLabelFakeCustomElement {\r\n\r\n}\r\n","<template>\r\n  label\r\n</template>\r\n","import { customElement, autoinject, bindable } from \"aurelia-framework\";\r\nimport { EventAggregator } from \"aurelia-event-aggregator\";\r\n\r\n\r\n@customElement(\"qp-longrun-indicator\")\r\n@autoinject\r\nexport class QpLongrunIndicatorCustomElement {\r\n  show: boolean = false\r\n\r\n  @bindable config\r\n\r\n  constructor(private eventAggregator: EventAggregator) {\r\n    eventAggregator.subscribe(\"longrun-started\", () => { this.show = true })\r\n    eventAggregator.subscribe(\"longrun-stopped\", () => { this.show = false })\r\n  }\r\n}\r\n","<template>\r\n  <div id=\"${config.id}\">\r\n\r\n  \r\n  <svg  if.bind=\"show\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" style=\"background:#fff;display:block;\" width=\"32px\" height=\"32px\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid\">\r\n    <g transform=\"rotate(0 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-1.1666666666666667s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(24 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-1.0833333333333333s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(48 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-1s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(72 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.9166666666666666s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(96 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.8333333333333334s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(120 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.75s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(144 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.6666666666666666s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(168 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.5833333333333334s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(192 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.5s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(216 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.4166666666666667s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(240 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.3333333333333333s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(264 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.25s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(288 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.16666666666666666s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(312 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"-0.08333333333333333s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g><g transform=\"rotate(336 50 50)\">\r\n      <rect x=\"48.5\" y=\"23\" rx=\"0.2\" ry=\"0.2\" width=\"3\" height=\"10\" fill=\"#999999\">\r\n        <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1.25s\" begin=\"0s\" repeatCount=\"indefinite\"></animate>\r\n      </rect>\r\n    </g>\r\n    </svg>\r\n  </div>\r\n</template>\r\n","import { customElement, noView, bindable, autoinject, Container, TargetInstruction, CompositionEngine, ViewResources, ViewSlot, Controller, metadata, HtmlBehaviorResource } from 'aurelia-framework'\r\n\r\nimport { getLogger } from \"aurelia-logging\";\r\nconst logger = getLogger('enhanced-compose')\r\n\r\n@noView\r\n@customElement(\"enhanced-compose\")\r\n@autoinject\r\nexport class EnhancedComposeCustomElement {\r\n  @bindable viewModel\r\n  expressions: any[];\r\n  bindingContext: any;\r\n  overrideContext: any;\r\n  currViewModel: any;\r\n  currViewModelPromise: any;\r\n  currentViewModelPromise: Promise<void>;\r\n  currentViewModel: any;\r\n\r\n  constructor(private container: Container, private viewResources: ViewResources, private element: Element, private targetInstruction: TargetInstruction, private compositionEngine: CompositionEngine) {\r\n\r\n    this.expressions = this.targetInstruction.expressions;\r\n    // targetInstruction.expressions = [];\r\n  }\r\n\r\n  bind(bindingContext, overrideContext) {\r\n    this.bindingContext = bindingContext;\r\n    this.overrideContext = overrideContext;\r\n    this.viewModelChanged(this.viewModel);\r\n  }\r\n\r\n\r\n  getViewModelClassFromTagName(customElementTagName: string) {\r\n    const r = this.viewResources.getElement(customElementTagName);\r\n    if (r) {\r\n      return r.target\r\n    }\r\n    else {\r\n      const r = this.viewResources.getElement('qp-text-editor')\r\n    }\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  async viewModelChanged(viewModel) {\r\n\r\n    // only compose once\r\n    // for the sake of simplicity\r\n    if (this.currViewModel || this.currViewModelPromise) {\r\n      return;\r\n    }\r\n    if (viewModel) {\r\n\r\n      const vmClass = this.getViewModelClassFromTagName(viewModel)\r\n      if (!vmClass) {\r\n        logger.error(\"No client control exists for tag\", viewModel)\r\n      }\r\n      const scope = {\r\n        bindingContext: this.bindingContext,\r\n        overrideContext: this.overrideContext,\r\n        viewModel: vmClass,// viewModel,\r\n        container: this.container,\r\n        host: this.element,\r\n        viewResources: this.container.get(ViewResources),\r\n        viewSlot: this.container.get(ViewSlot)\r\n      };\r\n      this.currentViewModelPromise = this.compositionEngine\r\n        .compose(scope)\r\n        .then(\r\n          (controller: Controller) => {\r\n\r\n            this.currentViewModel = controller.viewModel;\r\n            const behaviorResource = metadata.get(\r\n              metadata.resource,\r\n              controller.viewModel.constructor\r\n            ) as any;\r\n            if (behaviorResource) {\r\n              const bindables = behaviorResource.properties;\r\n              for (const property of bindables) {\r\n                const expression = this.expressions.find(\r\n                  exp => exp.targetProperty === property.name\r\n                );\r\n                if (expression) {\r\n                  const b = expression.createBinding(controller.viewModel);\r\n                  controller.view.addBinding(b);\r\n                }\r\n              }\r\n            }\r\n\r\n            controller.bind(scope);\r\n          },\r\n          ex => {\r\n            logger.error(\"error composing\",ex)\r\n          }\r\n        )\r\n        .then(() => {\r\n          this.currentViewModelPromise = undefined;\r\n        });\r\n    }\r\n  }\r\n}\r\n","import { Aurelia, PLATFORM } from 'aurelia-framework'\r\nimport environment from '../../environment';\r\nimport { EnhancedComposeCustomElement } from './enhanced-compose';\r\nimport { QpOutlookDataCustomElement } from './controls/outlook-data/outlook-data';\r\n// import { QpCommandButtonCustomElement } from './controls/qp-command-button';\r\nimport { QpContainerCustomElement } from './controls/qp-container';\r\nimport { QpLabeledControlCustomElement } from './controls/containers/labeled-control';\r\nimport { QpLabelFakeCustomElement } from './controls/qp-label-fake';\r\nimport { QpLongrunIndicatorCustomElement } from './controls/qp-longrun-indicator';\r\nimport { QpFieldsetCustomElement } from './controls/containers/qp-fieldset';\r\n\r\nexport function configure(aurelia: Aurelia) {\r\n\r\n  const globalFeatures = PLATFORM.global.globalControlsModules\r\n  aurelia.use\r\n    .basicConfiguration()\r\n    .plugin('aurelia-dialog')\r\n    .plugin('aurelia-ui-virtualization');\r\n\r\n  [\"apps/enhance/controls\", \"plugins/glue\"].forEach(i => {\r\n    aurelia.use.feature(i)\r\n  })\r\n\r\n  if (Array.isArray(globalFeatures)) {\r\n    globalFeatures.forEach(x => aurelia.use.feature(x))\r\n  }\r\n  aurelia.use.globalResources([EnhancedComposeCustomElement, QpOutlookDataCustomElement, QpContainerCustomElement, QpLabelFakeCustomElement, QpLabeledControlCustomElement,QpLongrunIndicatorCustomElement,QpFieldsetCustomElement])\r\n\r\n  aurelia.use.developmentLogging(environment.debug ? 'debug' : 'warn');\r\n\r\n  if (environment.testing) {\r\n    aurelia.use.plugin('aurelia-testing');\r\n  }\r\n\r\n  aurelia.start().then(() => aurelia.setRoot());\r\n  PLATFORM.global.getViewModelById = function (id: string) {\r\n\t\r\n\t\t\tlet elem: any = document.getElementById(id)\r\n\t\t\tif (elem) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (elem.au) {\r\n\t\t\t\t\t\treturn elem.au.controller.viewModel.currentViewModel || elem.au.controller.viewModel\r\n\t\t\t\t\t}\r\n\t\t\t\t\telem = elem.parentNode\r\n\t\t\t\t} while (elem)\r\n\t\t\t\treturn undefined\r\n\t\t\t}\r\n\t\t\r\n\t}\r\n}\r\n","import { autoinject } from \"aurelia-framework\";\r\nimport { HttpClient, json } from 'aurelia-fetch-client'\r\n\r\ndeclare var requirejs\r\n\r\nconst root = requirejs.s.contexts._.config.baseUrl.replace(\"/scripts/ca/\", \"/\")\r\n@autoinject\r\nexport class AuthenticationService {\r\n\r\n\r\n  public authenticated: boolean = false\r\n  outlookAuthToken: string;\r\n  exId: string;\r\n\r\n  constructor(private client: HttpClient) {\r\n    const _this = this\r\n    this.client.configure(config => {\r\n\r\n      config.withInterceptor({\r\n        request(request) {\r\n          request.headers.set(\"Authorization\", `Bearer ${_this.outlookAuthToken}`)\r\n          return request\r\n        },\r\n        response(response, request) {\r\n          const reqUrl = request.url.toLowerCase()\r\n\r\n          if (reqUrl.indexOf('authdock') || reqUrl.indexOf('login')) {\r\n            return response\r\n          }\r\n          if (response.redirected && response.url.toLowerCase().indexOf('login') > -1) {\r\n            _this.authenticated = false\r\n            throw new Error('not authenticated')\r\n          } else {\r\n            return response\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  setUserToken(token: string) {\r\n    this.outlookAuthToken = token\r\n  }\r\n\r\n  async isUserAssociated() {\r\n    return this.client.fetch(\"newui/look/isUserAssociated\")\r\n      .then(x => this.authenticated = x.redirected ? false : true)\r\n      .catch(x => this.authenticated = false)\r\n\r\n  }\r\n\r\n  async signInWithToken(token: string) {\r\n    this.outlookAuthToken = token\r\n    let signedIn\r\n    let failedToSignIn\r\n    const result = new Promise((resolve, reject) => { signedIn = resolve; failedToSignIn = reject })\r\n\r\n    // Office.context.mailbox.getUserIdentityTokenAsync((asyncResult) => {\r\n\r\n    const formData = new FormData();\r\n    formData.append('token', this.outlookAuthToken);\r\n\r\n    this.client.fetch(`Frames/AuthDock.ashx?_returnUrl_=${root}success`, {\r\n      method: 'POST',\r\n      body: formData\r\n    }).then(async tokenAuthResult => {\r\n\r\n      if (tokenAuthResult.redirected) {\r\n\r\n        if (tokenAuthResult.url.endsWith('success')) {\r\n\r\n          this.authenticated = true\r\n          signedIn()\r\n        } else {\r\n          this.authenticated = false\r\n          if (tokenAuthResult.url.toLocaleLowerCase().indexOf('login') > -1) {\r\n            const target = new URL(tokenAuthResult.url)\r\n            this.exId = target.searchParams.get('exceptionid')\r\n          }\r\n\r\n          failedToSignIn()\r\n        }\r\n      }\r\n\r\n    })\r\n    // }    )\r\n    return result\r\n  }\r\n\r\n  async associateUser(username: string, password: string, company: string = null, locale: string = null) {\r\n\r\n   \r\n\r\n    this.client.fetch(`ui/Outlook/AssociateUser`, {\r\n      method: 'POST',\r\n      body: json({ Login: username, Password: password, Company: company, Locale: locale })\r\n    })\r\n      .then((r) => {\r\n       \r\n        if (r.ok) {\r\n          this.authenticated = true\r\n        } else {\r\n          this.authenticated = false\r\n        }\r\n\r\n      })\r\n\r\n\r\n  }\r\n  async logIn(username: string, password: string, company: string = null, locale: string = null) {\r\n\r\n    if (!this.exId && this.outlookAuthToken) {\r\n      try {\r\n        await this.signInWithToken(this.outlookAuthToken)\r\n      } catch {\r\n\r\n      }\r\n    }\r\n\r\n    return this.client.fetch(`ui/Outlook/LogIn?exceptionid=${this.exId}`, {\r\n      method: 'POST',\r\n      body: json({ Login: username, Password: password, Company: company, Locale: locale })\r\n    })\r\n      .then((r) => {\r\n        this.exId = undefined\r\n        if (r.ok) {\r\n          this.authenticated = true\r\n        } else {\r\n          this.authenticated = false\r\n        }\r\n\r\n      })\r\n\r\n\r\n  }\r\n\r\n  lostAuth() {\r\n    this.authenticated = false\r\n  }\r\n}\r\n","import { autoinject } from \"aurelia-framework\";\r\n\r\nimport { HttpClient, json } from 'aurelia-fetch-client'\r\n\r\nlet apiRoot = 'newui/look/schema'\r\n\r\n@autoinject\r\nexport class ScreenApiClient {\r\n\r\n\r\n  constructor(private client: HttpClient,) {\r\n\r\n  }\r\n\r\n  getScreenConfig(screenId: string): Promise<IScreenApiResult> {\r\n    return this.client.fetch(`${apiRoot}/${screenId}`)\r\n      .then(x => x.json())\r\n  }\r\n\r\n  postScreenData(screenId: string, data: {}): Promise<IScreenApiResult> {\r\n    return this.client.fetch(`${apiRoot}/${screenId}`,\r\n      {\r\n        method: 'POST',\r\n        body: json(data)\r\n      }).then(x => x.json())\r\n  }\r\n}\r\n\r\n@autoinject\r\nexport class LoginApiClient {\r\n  constructor(private client: HttpClient) {\r\n\r\n  }\r\n\r\n  getLocalesFor(company: string): Promise<{ Name: string, DisplayName: string }[]> {\r\n    return this.client.fetch(`${apiRoot}/localesFor/${company}`)\r\n      .then(x => x.json())\r\n  }\r\n}\r\n\r\n\r\nexport class ApiManager {\r\n  setApiRoot(newApiRoot: string) {\r\n    apiRoot = newApiRoot\r\n  }\r\n}\r\nexport interface IScreenApiResult {\r\n  diffType: string\r\n  mode?: string\r\n  url?: string\r\n  controls: IControl[],\r\n  configs: { [x: string]: {} },\r\n  longRunStatus?: number,\r\n  fieldValues: {\r\n    [x: string]: {\r\n      [x: string]: any\r\n    }\r\n  }\r\n}\r\n\r\nexport interface IControl {\r\n  type: string,\r\n  id: string,\r\n  view: string\r\n  field: string\r\n  controls: []\r\n}\r\n","import { singleton, TaskQueue, BindingEngine, autoinject, Disposable } from 'aurelia-framework'\r\nimport { EventAggregator } from 'aurelia-event-aggregator'\r\nimport { ScreenApiClient, IControl } from './screen-api-client'\r\n\r\nconst RECORD_ID = '_RecordId'\r\n\r\n@singleton(\"screen-data\")\r\nexport class ScreenData {\r\n  fieldValues: {} = {}\r\n  configs: {} = {}\r\n\r\n  setValue(id: { view: string, field: string }, value: unknown) {\r\n    this.fieldValues[id.view][id.field] = value\r\n  }\r\n}\r\n\r\n// @singleton(\"screen-data\")\r\n@autoinject\r\nexport class ScreenInfo {\r\n\r\n\r\n  controls: IControl[]\r\n  originalValues: {} = {}\r\n  dirtyValues: {} = {}\r\n  screenId: string\r\n  longRunPollingInterval: any\r\n  saving: boolean\r\n  propSubscriptions: Disposable[] = []\r\n\r\n  constructor(private eventAggregator: EventAggregator, private screenData: ScreenData, private screenApiClient: ScreenApiClient, private bindingEngine: BindingEngine, private tq: TaskQueue) {\r\n    this.eventAggregator.subscribe(\"execute-command\", (d) => {\r\n\r\n      this.tq.flushMicroTaskQueue();\r\n      this.tq.queueTask(() => {\r\n        this.updateScreen(d)\r\n      })\r\n    })\r\n\r\n  }\r\n\r\n  findControl(controls: IControl[], view: string, field: string): IControl {\r\n\r\n    for (let i = 0; i < controls.length; i++) {\r\n      const element = controls[i];\r\n      if (element.field === field && element.view === view) return element\r\n      if (element.controls) {\r\n        const child = this.findControl(element.controls, view, field)\r\n        if (child) {\r\n          return child\r\n        }\r\n      }\r\n\r\n    }\r\n    return undefined\r\n  }\r\n\r\n  async initScreen(screenId: string, blackBoxMatters?: unknown) {\r\n    this.screenData.fieldValues = {}\r\n    this.screenData.configs = {}\r\n    this.controls = []\r\n    this.screenId = screenId\r\n    this.saving = true\r\n    return this.screenApiClient.getScreenConfig(screenId)\r\n      // .then()\r\n      // this.client.fetch(`${this.root}/newui/test/OutlookPlugin`)\r\n      //   .then(x => x.json())\r\n      .then(x => {\r\n        this.controls = x.controls\r\n        // this.newModel = x;\r\n        // this.controls = x.controls\r\n        // this.values = x.values\r\n        this.screenData.fieldValues = x.fieldValues\r\n        this.originalValues = JSON.parse(JSON.stringify(x.fieldValues))\r\n        this.screenData.configs = x.configs\r\n\r\n\r\n\r\n        for (let viewName in x.fieldValues) {\r\n          if (x.fieldValues.hasOwnProperty(viewName)) {\r\n            const viewFields = x.fieldValues[viewName]\r\n            for (let fieldName in viewFields) {\r\n              if (viewFields.hasOwnProperty(fieldName)) {\r\n                // const autopostback = x.configs[key]?.AutoPostback\r\n                let autopostback = false\r\n\r\n                const control = this.findControl(x.controls, viewName, fieldName)\r\n                if (control) {\r\n                  const config = x.configs[control.id]\r\n                  if (config && config.autopostback) {\r\n                    autopostback = true\r\n                  }\r\n                }\r\n                const ob = this.generateValueObserver(viewName, fieldName, autopostback)\r\n                this.propSubscriptions.push(this.bindingEngine.propertyObserver(this.screenData.fieldValues[viewName], fieldName).subscribe(ob))\r\n              }\r\n            }\r\n\r\n            // const autopostback = x.configs[key]?.AutoPostback\r\n            // const ob = this.generateValueObserver(key, autopostback)\r\n            // this.bindingEngine.propertyObserver(this.screenData.fieldValues, key).subscribe(ob)\r\n          }\r\n        }\r\n        this.saving = false\r\n        this.eventAggregator.publish(\"screen-updated\")\r\n      })\r\n  }\r\n\r\n  async updateScreen(command?: string, force?: boolean = false) {\r\n    this.saving = true;\r\n\r\n\r\n    const saveData = Object.assign({}, { data: this.dirtyValues }, { command: command })\r\n    let haveData = false\r\n    for (let viewName in saveData.data) {\r\n      if (saveData.data.hasOwnProperty(viewName)) {\r\n        const viewFields = saveData.data[viewName]\r\n        for (let fieldName in viewFields) {\r\n          if (viewFields.hasOwnProperty(fieldName)) {\r\n            haveData = true\r\n            saveData.data[viewName][RECORD_ID] = this.screenData.fieldValues[viewName][RECORD_ID]\r\n            break\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!haveData && !command && !force) {\r\n      return\r\n    }\r\n\r\n    const updates = await this.screenApiClient.postScreenData(this.screenId, saveData)\r\n\r\n    if (updates.diffType == undefined) {\r\n      this.originalValues = JSON.parse(JSON.stringify(updates.fieldValues))\r\n      const newValues = updates.fieldValues\r\n\r\n      for (let viewName in newValues) {\r\n        if (newValues.hasOwnProperty(viewName)) {\r\n          const viewFields = newValues[viewName]\r\n          for (let fieldName in viewFields) {\r\n            if (viewFields.hasOwnProperty(fieldName)) {\r\n              let needObserver = false\r\n              if (!this.screenData.fieldValues.hasOwnProperty(viewName)) {\r\n                this.screenData.fieldValues[viewName] = {}\r\n                // this.originalValues[viewName] = {}\r\n              }\r\n              if (!this.screenData.fieldValues[viewName].hasOwnProperty(fieldName)) {\r\n                needObserver = true\r\n                // this.originalValues[viewName][fieldName] = viewFields[fieldName]\r\n              }\r\n              // const autopostback = x.configs[key]?.AutoPostback\r\n              this.screenData.fieldValues[viewName][fieldName] = viewFields[fieldName]\r\n              if (needObserver) {\r\n                let autopostback = false\r\n                const control = this.findControl(updates.controls, viewName, fieldName)\r\n                if (control) {\r\n                  const config = updates.configs[control.id]\r\n                  if (config && config.autopostback) {\r\n                    autopostback = true\r\n\r\n                  }\r\n                }\r\n                const ob = this.generateValueObserver(viewName, fieldName, autopostback)\r\n                this.bindingEngine.propertyObserver(this.screenData.fieldValues[viewName], fieldName).subscribe(ob)\r\n              }\r\n            }\r\n          }\r\n\r\n          // const autopostback = x.configs[key]?.AutoPostback\r\n          // const ob = this.generateValueObserver(key, autopostback)\r\n          // this.bindingEngine.propertyObserver(this.screenData.fieldValues, key).subscribe(ob)\r\n        }\r\n      }\r\n      this.screenData.configs = updates.configs\r\n      for (let i = 0; i < this.controls.length; i++) {\r\n        let c = this.controls[i]\r\n\r\n        if (!c.controls || c.controls) {\r\n          const up = updates.controls.find(u => u.id == c.id)\r\n          if (up.controls && up.controls.length !== c.controls?.length)\r\n            c.controls = up.controls\r\n        }\r\n      }\r\n\r\n    }\r\n    this.tq.flushMicroTaskQueue()\r\n    this.dirtyValues = {}\r\n    if (updates.longRunStatus) {\r\n      if (updates.longRunStatus == 1) {\r\n        this.eventAggregator.publish(\"longrun-started\")\r\n        console.log(\"longrun detected\")\r\n        clearInterval(this.longRunPollingInterval)\r\n        this.longRunPollingInterval = setInterval(() => { this.updateScreen(undefined, true) }, 5000)\r\n        console.log(this.longRunPollingInterval)\r\n      } else if (updates.longRunStatus > 1) {\r\n        console.log(\"longrun stopped\")\r\n        this.eventAggregator.publish(\"longrun-stopped\")\r\n        clearInterval(this.longRunPollingInterval)\r\n      }\r\n    }\r\n    this.saving = false\r\n    this.eventAggregator.publish(\"screen-updated\")\r\n  }\r\n  // storeValues(values: {}) {\r\n  //   this.fieldValues = values\r\n  // }\r\n\r\n  // storeConfigs(configs: {}) {\r\n  //   this.configs = configs\r\n  // }\r\n  // getValue(id: string): unknown {\r\n  //   return this.values[id]\r\n  // }\r\n\r\n  destroyScreen(){\r\n    this.screenData.fieldValues = {}\r\n    this.screenData.configs = {}\r\n    this.controls = []\r\n    this.propSubscriptions.forEach(s=>s.dispose())\r\n    this.propSubscriptions = []\r\n  }\r\n\r\n  executeCommand(command: any) {\r\n    this.tq.flushMicroTaskQueue();\r\n    this.eventAggregator.publish(\"execute-command\", command)\r\n  }\r\n\r\n  generateValueObserver(viewName: string, fieldName: string, autoPostback: boolean) {\r\n\r\n\r\n    return (newValue, oldValue) => {\r\n      if (!this.saving) {\r\n        if (!this.dirtyValues[viewName]) {\r\n          this.dirtyValues[viewName] = {}\r\n        }\r\n        this.dirtyValues[viewName][fieldName] = newValue\r\n\r\n        // replace with equals for object\r\n        if (this.dirtyValues[viewName][fieldName] === this.originalValues[viewName][fieldName]) {\r\n          delete this.dirtyValues[viewName][fieldName]\r\n        }\r\n\r\n        if (autoPostback) {\r\n          this.updateScreen()\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}